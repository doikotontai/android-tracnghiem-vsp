<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Learning Content Galaxy - VEO3</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    holo: {
                        bg: "#050810",
                        surface: "rgba(10, 20, 35, 0.9)", 
                        border: "rgba(100, 220, 255, 0.3)",
                        text: "#d0e0ff",
                        cyan: "#00f0ff",
                        purple: "#bc13fe",
                        green: "#0aff0a",
                        blue: "#3b82f6"
                    }
                },
                fontFamily: {
                    sans: ["Inter", "sans-serif"],
                    display: "Be Vietnam Pro"
                },
                animation: {
                    'pulse-glow': 'pulseGlow 4s infinite alternate',
                    'spin-slow': 'spin 20s linear infinite',
                },
                keyframes: {
                    pulseGlow: {
                        '0%': { opacity: 0.8, filter: 'brightness(1)' },
                        '100%': { opacity: 1, filter: 'brightness(1.3)' },
                    }
                }
            }
        }
    };
</script>
<style type="text/tailwindcss">
    body {
        @apply bg-holo-bg text-holo-text overflow-hidden font-sans;
        touch-action: none;
        -webkit-tap-highlight-color: transparent;
    }

    /* --- Background --- */
    .conceptual-map-container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        background: 
            radial-gradient(circle at 50% 50%, rgba(20, 30, 60, 0.4) 0%, rgba(5, 8, 16, 1) 80%),
            linear-gradient(rgba(0, 240, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 240, 255, 0.05) 1px, transparent 1px);
        background-size: 100% 100%, 40px 40px, 40px 40px;
        perspective: 1000px;
        will-change: transform; /* Tối ưu render */
    }

    /* --- Connecting Lines --- */
    .connecting-line {
        position: absolute;
        height: 1px;
        background: linear-gradient(90deg, rgba(0, 240, 255, 0.1), rgba(0, 240, 255, 0.6), rgba(0, 240, 255, 0.1));
        transform-origin: 0 50%;
        pointer-events: none;
        z-index: 5;
        opacity: 0;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
    }

    /* --- Nodes Common --- */
    .map-node {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        backdrop-filter: blur(4px);
        /* Tinh chỉnh transition để mượt hơn */
        transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
        will-change: transform, left, top;
        -webkit-user-select: none;
        user-select: none;
    }

    .node-hidden {
        opacity: 0;
        pointer-events: none;
        transform: scale(0) translateZ(0) !important;
    }

    /* --- Main Node (Sun) --- */
    .map-node.type-main {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: radial-gradient(circle at 35% 35%, rgba(255, 255, 255, 0.9) 0%, rgba(0, 220, 255, 0.6) 20%, rgba(0, 80, 200, 0.8) 50%, rgba(0, 10, 30, 0.95) 100%);
        box-shadow: 0 0 30px rgba(0, 200, 255, 0.4);
        border: 1px solid rgba(100, 220, 255, 0.4);
        color: white;
        font-weight: 700;
        font-size: 1rem;
        text-align: center;
        z-index: 20;
    }
    .map-node.type-main::after {
        content: '';
        position: absolute;
        inset: -10px;
        border-radius: 50%;
        border: 1px dashed rgba(0, 240, 255, 0.3);
        animation: spin-slow 20s linear infinite;
    }
    
    @media (min-width: 768px) {
        .map-node.type-main { width: 150px; height: 150px; font-size: 1.25rem; }
    }

    /* --- Topic Nodes --- */
    .map-node.type-topic {
        background: rgba(15, 25, 45, 0.7);
        border: 1px solid rgba(0, 240, 255, 0.3);
        border-radius: 50px;
        padding: 8px 16px;
        color: #fff;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        min-width: 100px;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.1);
    }
    /* Special style for Video Node (formerly Docs) */
    .map-node.type-topic.video-trigger {
        border-color: #f00; /* Youtube Red hint */
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
    }
    .map-node.type-topic.video-trigger .material-symbols-outlined {
        color: #ff4444;
    }

    .map-node.type-topic:active, .map-node.type-topic.active-cluster {
        background: rgba(0, 240, 255, 0.15);
        border-color: #00f0ff;
        box-shadow: 0 0 25px rgba(0, 240, 255, 0.3);
        transform: scale(1.05);
    }
    
    @media (min-width: 768px) {
        .map-node.type-topic { padding: 12px 24px; font-size: 0.9rem; min-width: 140px; }
    }

    /* --- Leaf Nodes --- */
    .map-node.type-image {
        background: rgba(5, 10, 20, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 0.7rem;
        color: rgba(200, 230, 255, 0.8);
        display: flex;
        align-items: center;
        gap: 6px;
        max-width: 140px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        border-left: 2px solid #4ade80;
    }
    .map-node.type-image .material-symbols-outlined { color: #4ade80; font-size: 16px; }

    .map-node.active-node {
        background: rgba(20, 40, 80, 0.95);
        border-color: #fff;
        color: #fff;
        z-index: 50;
        transform: scale(1.1);
    }

    /* --- Content Panel (CENTER MODAL STYLE) --- */
    .node-content-panel {
        background: rgba(12, 18, 32, 0.95);
        border: 1px solid rgba(0, 240, 255, 0.3);
        backdrop-filter: blur(20px);
        color: #e0f0ff;
        z-index: 100;
        
        /* Center Positioning Logic */
        position: fixed;
        top: 50%;
        left: 50%;
        width: 90%;
        max-width: 500px; /* Độ rộng tối đa */
        max-height: 85vh;
        
        /* Initial State: Hidden & Scaled Down */
        transform: translate(-50%, -50%) scale(0.9);
        opacity: 0;
        pointer-events: none;
        
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,255,255,0.1);
        
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
        will-change: transform, opacity;
    }

    .node-content-panel.panel-visible {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
        pointer-events: auto;
    }

    /* Video Container Aspect Ratio */
    .aspect-video-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        background: #000;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    }
    .aspect-video-container iframe, 
    .aspect-video-container video,
    .aspect-video-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
</style>
</head>
<body class="min-h-screen flex flex-col bg-black">

<!-- Mobile Header -->
<div class="fixed top-4 left-4 z-30 pointer-events-none md:hidden">
    <div class="flex items-center space-x-2 bg-black/40 backdrop-blur rounded-full p-1 pr-3 border border-white/10 pointer-events-auto">
        <div class="w-8 h-8 rounded-full bg-holo-cyan/20 flex items-center justify-center text-holo-cyan">
            <span class="material-symbols-outlined text-lg">science</span>
        </div>
        <span class="text-xs font-bold text-white tracking-widest">VEO3</span>
    </div>
</div>

<!-- Overlay for Modal -->
<div id="panel-overlay" class="fixed inset-0 bg-black/70 backdrop-blur-[2px] z-50 hidden opacity-0 transition-opacity duration-300" onclick="closePanel()"></div>

<!-- Main Canvas -->
<main class="flex-grow w-full relative h-screen overflow-hidden">
    <div class="absolute inset-0 conceptual-map-container" id="learning-galaxy">
        
        <!-- Center Core -->
        <div class="map-node type-main animate-pulse-glow" id="main-node">
            VEO3
        </div>

        <!-- Topic: Video (Formerly Docs) -->
        <div class="map-node type-topic video-trigger" data-node-id="core-docs">
            <span class="material-symbols-outlined text-base mr-1 md:mr-2">play_circle</span>
            VIDEO HDSD
        </div>

        <!-- Topic: Visual Assets (Updated to use List View) -->
        <div class="map-node type-topic" data-node-id="visual-assets">
            <span class="material-symbols-outlined text-base mr-1 md:mr-2">perm_media</span>
            Assets
        </div>

        <!-- NEW: Structure Map Node (Formerly Widget) -->
        <div class="map-node type-topic" data-node-id="structure-map">
            <span class="material-symbols-outlined text-base mr-1 md:mr-2">hub</span>
            SƠ ĐỒ TỔNG
        </div>
        
    </div>

    <!-- DETAILS PANEL (Center Modal) -->
    <div class="node-content-panel" id="content-detail-panel">
        
        <button class="absolute top-4 right-4 text-white/50 hover:text-white p-2 z-10" onclick="closePanel()">
            <span class="material-symbols-outlined">close</span>
        </button>
        
        <h3 class="font-semibold text-lg mb-2 flex items-center text-white pr-8">
            <span class="material-symbols-outlined text-xl mr-2 text-holo-cyan" id="panel-icon"></span>
            <span id="panel-title">Tiêu đề</span>
        </h3>
        
        <div class="h-px w-full bg-gradient-to-r from-holo-cyan/50 to-transparent mb-4"></div>
        
        <div class="overflow-y-auto max-h-[60vh] pr-1 scrollbar-hide">
            <!-- Media Container (16:9) -->
            <div class="aspect-video-container mb-4 hidden" id="media-container">
                <!-- Youtube Iframe placeholder -->
                <div id="youtube-embed"></div>
                <!-- Standard Image/Video fallback -->
                <img alt="Content preview" class="hidden" id="panel-image" src=""/>
                <video class="hidden" controls="" id="panel-video" src=""></video>
            </div>

            <!-- List Container (New: For listing children vertically) -->
            <div class="hidden flex flex-col gap-2 mb-4" id="list-container"></div>

            <p class="text-sm text-gray-300 leading-relaxed mb-4" id="panel-description">Mô tả nội dung...</p>
        </div>
        
        <a class="flex items-center justify-center w-full py-3 bg-holo-cyan text-black font-bold rounded-lg mt-2 active:scale-95 transition-transform" href="#" id="panel-link" target="_blank">
            <span>TRUY CẬP DỮ LIỆU</span>
            <span class="material-symbols-outlined text-lg ml-2">arrow_forward</span>
        </a>
    </div>

</main>

<script>
    // --- Data Configuration ---
    const nodeData = {
        'core-docs': {
            // NEW: Video configuration
            title: 'HƯỚNG DẪN VẬN HÀNH VEO3',
            description: 'Xem video chi tiết quy trình lắp đặt và vận hành hệ thống VEO3.',
            icon: 'play_circle',
            link: 'https://youtu.be/b2TZ0QTYN-I',
            videoType: 'youtube', 
            videoSrc: 'https://www.youtube.com/embed/b2TZ0QTYN-I?autoplay=1', 
            children: [] 
        },
        'visual-assets': {
            title: 'HƯỚNG DẪN VẬN HÀNH VEO3',
            description: 'Danh sách các sơ đồ khối',
            icon: 'perm_media',
            link: '#',
            viewType: 'list', // Signal to use List View in Panel instead of Graph Expansion
            children: [
                { type: 'image', title: '1 – KHỞI ĐỘNG & CHUẨN BỊ HỆ THỐNG', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 1.png' },
                { type: 'image', title: '2 – TẠO SETUP MỚI (CREATE CONFIGURATION)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 2.png' },
                { type: 'image', title: '3 – KHAI BÁO ĐẦU DÒ/NÊM (LOAD PROBE/WEDGE)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 3.png' },
                { type: 'image', title: '4 – THIẾT LẬP SCAN PLAN (GROUP SETUP)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 4.png' },
                { type: 'image', title: '5 – TẠO GROUP 2 (NẾU CẦN)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 5.png' },
                { type: 'image', title: '6 – HIỆU CHUẨN (CALIBRATION)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 6.png' },
                { type: 'image', title: '7 – HOÀN THIỆN THIẾT LẬP (FINAL SETUP)', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 7.png' },
                { type: 'image', title: '8 – QUÉT THỰC TẾ & DỮ LIỆU', description: 'Phân tích cấu trúc khối 1.', icon: 'image', link: '#', details: 'IMG // 4.6 MB', image: './media_veo3/Khối 8.png' },
		]
        },
        // NEW: Structure Map Data
        'structure-map': {
            title: 'Sơ Đồ Hệ Thống',
            description: 'Sơ đồ tổng quan toàn bộ hệ thống VEO3.',
            icon: 'hub',
            link: '#',
            image: './media_veo3/so-do-mindmap-tong.png',
            children: []
        }
    };

    // --- State ---
    const state = {
        activeCluster: null,
        activeLeaf: null,
    };

    // --- DOM ---
    const galaxy = document.getElementById('learning-galaxy');
    const mainNode = document.getElementById('main-node');
    const contentPanel = document.getElementById('content-detail-panel');
    const overlay = document.getElementById('panel-overlay'); // NEW Overlay
    const mediaContainer = document.getElementById('media-container');
    const listContainer = document.getElementById('list-container');
    const youtubeEmbed = document.getElementById('youtube-embed');
    
    // Panel Elements
    const pTitle = document.getElementById('panel-title');
    const pDesc = document.getElementById('panel-description');
    const pIcon = document.getElementById('panel-icon');
    const pImg = document.getElementById('panel-image');
    const pVid = document.getElementById('panel-video');
    const pLink = document.getElementById('panel-link');

    // --- Logic ---
    function init() {
        positionNodes();
        window.addEventListener('resize', () => positionNodes());
    }

    function positionNodes() {
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        const isMobile = window.innerWidth < 768;
        const offsetX = 0; // Removed widget offset logic

        mainNode.style.left = `${cx + offsetX}px`;
        mainNode.style.top = `${cy}px`;
        mainNode.style.transform = 'translate(-50%, -50%)';

        const topics = document.querySelectorAll('.map-node.type-topic');
        const radius = isMobile ? 110 : 250; 
        
        topics.forEach((topic, index) => {
            let angle;
            if (isMobile) {
                // Top, Bottom, and maybe Bottom-Right?
                // Distribute evenly for mobile too if possible, or use fixed points
                const angles = [-Math.PI/2, Math.PI/2, Math.PI]; // Top, Bottom, Left?
                // Let's use standard even distribution for 3 items
                 angle = (index / topics.length) * 2 * Math.PI - Math.PI/2; 
            } else {
                angle = (index / topics.length) * 2 * Math.PI - Math.PI/2; // Start from top
            }

            const x = (cx + offsetX) + radius * Math.cos(angle);
            const y = cy + radius * Math.sin(angle);

            topic.style.left = `${x}px`;
            topic.style.top = `${y}px`;
            topic.style.transform = 'translate(-50%, -50%)';
            
            if(state.activeCluster) {
                 setTimeout(() => {
                     const parent = document.querySelector(`[data-node-id="${state.activeCluster}"]`);
                     if(parent) expandCluster(state.activeCluster, parent);
                 }, 300);
            }
        });
    }

    // --- Interactions ---
    document.querySelectorAll('.map-node').forEach(node => {
        node.addEventListener('click', (e) => {
            e.stopPropagation();
            const nodeId = node.dataset.nodeId;
            const parentId = node.dataset.parentNode;

            if (nodeId) { // Topic Clicked
                const data = nodeData[nodeId];
                
                // SHOW PANEL DIRECTLY for Video, List, OR Image (Structure Map)
                if (data && (data.videoType === 'youtube' || data.viewType === 'list' || data.image)) {
                    // Close other clusters if open
                    if (state.activeCluster) collapseCluster(state.activeCluster);
                    
                    // Show Panel Directly
                    showPanel(data);
                    return;
                }

                // Normal Cluster Logic (Graph Expansion)
                if (state.activeCluster === nodeId) {
                    collapseCluster(nodeId);
                } else {
                    if (state.activeCluster) collapseCluster(state.activeCluster);
                    expandCluster(nodeId, node);
                }
            } else if (parentId) { // Leaf Clicked (if any exist on map)
                handleLeafClick(node, parentId);
            } else if (node === mainNode) {
                showPanel({
                    title: 'Hệ Thống VEO3',
                    description: 'Trạng thái hoạt động bình thường.',
                    icon: 'science',
                    link: '#'
                });
            }
        });
    });

    document.addEventListener('click', (e) => {
        // Chỉ đóng khi click ra ngoài panel và overlay đang hiện
        if (contentPanel.classList.contains('panel-visible') && !contentPanel.contains(e.target) && !e.target.closest('.map-node')) {
            // closePanel(); // Logic này giờ được xử lý bởi Overlay click
        }
    });

    // --- Cluster Logic ---
    function expandCluster(clusterId, parentNode) {
        state.activeCluster = clusterId;
        parentNode.classList.add('active-cluster');
        document.querySelectorAll(`.line-${clusterId}`).forEach(l => l.remove());

        const children = document.querySelectorAll(`[data-parent-node="${clusterId}"]`);
        const cx = parseFloat(parentNode.style.left);
        const cy = parseFloat(parentNode.style.top);
        const isMobile = window.innerWidth < 768;
        const radius = isMobile ? 120 : 180;
        
        children.forEach((child, index) => {
            child.classList.remove('hidden', 'node-hidden');
            let angle;
            if (isMobile) {
                const isTop = cy < window.innerHeight / 2;
                const baseAngle = isTop ? Math.PI/2 : -Math.PI/2;
                const spread = Math.PI * 0.8;
                const start = baseAngle - spread/2;
                const step = spread / (children.length - 1 || 1);
                angle = children.length === 1 ? baseAngle : start + (index * step);
            } else {
                angle = (index / children.length) * 2 * Math.PI;
            }

            const tx = cx + radius * Math.cos(angle);
            const ty = cy + radius * Math.sin(angle);

            child.style.left = `${tx}px`;
            child.style.top = `${ty}px`;
            child.style.transform = 'translate(-50%, -50%) scale(1)';

            setTimeout(() => createLine(parentNode, child, `line-${clusterId}`), 300);
        });
    }

    function collapseCluster(clusterId) {
        const parentNode = document.querySelector(`[data-node-id="${clusterId}"]`);
        if(parentNode) parentNode.classList.remove('active-cluster');
        const children = document.querySelectorAll(`[data-parent-node="${clusterId}"]`);
        const cx = parseFloat(parentNode.style.left);
        const cy = parseFloat(parentNode.style.top);

        document.querySelectorAll(`.line-${clusterId}`).forEach(l => l.remove());
        children.forEach(child => {
            child.style.left = `${cx}px`;
            child.style.top = `${cy}px`;
            child.classList.add('node-hidden');
            setTimeout(() => child.classList.add('hidden'), 400);
        });
        state.activeCluster = null;
        closePanel();
    }

    // --- Content Logic ---
    function handleLeafClick(node, parentId) {
        if (state.activeLeaf) state.activeLeaf.classList.remove('active-node');
        state.activeLeaf = node;
        node.classList.add('active-node');
        const text = node.textContent.trim();
        const data = nodeData[parentId].children.find(c => text.includes(c.title));
        if(data) showPanel(data);
    }

    function showPanel(data) {
        // Stop current video if playing
        youtubeEmbed.innerHTML = '';
        pVid.pause();

        pTitle.textContent = data.title;
        pDesc.textContent = data.description;
        pIcon.textContent = data.icon;
        pLink.href = data.link;

        // Reset Containers
        mediaContainer.classList.add('hidden');
        listContainer.classList.add('hidden');
        pImg.classList.add('hidden');
        pVid.classList.add('hidden');
        youtubeEmbed.classList.add('hidden');
        
        // Clean up List Container
        listContainer.innerHTML = '';

        if (data.viewType === 'list') {
            // VIEW TYPE: LIST
            listContainer.classList.remove('hidden');
            if (data.children && data.children.length > 0) {
                data.children.forEach(child => {
                    const item = document.createElement('div');
                    item.className = 'flex items-center p-3 bg-white/5 border border-white/10 rounded-lg hover:bg-white/10 cursor-pointer transition-colors group';
                    item.innerHTML = `
                        <div class="w-10 h-10 rounded bg-holo-blue/20 flex items-center justify-center mr-3 border border-holo-blue/30">
                            <span class="material-symbols-outlined text-holo-blue">${child.icon || 'image'}</span>
                        </div>
                        <div class="flex-grow">
                            <div class="font-medium text-sm text-white group-hover:text-holo-cyan transition-colors">${child.title}</div>
                            <div class="text-xs text-gray-400">${child.details || 'Chi tiết'}</div>
                        </div>
                        <span class="material-symbols-outlined text-white/20 group-hover:text-white transition-colors text-sm">arrow_forward_ios</span>
                    `;
                    item.onclick = () => showPanel(child);
                    listContainer.appendChild(item);
                });
            } else {
                 listContainer.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">Chưa có dữ liệu.</p>';
            }
        } else if (data.videoType === 'youtube') {
            // VIEW TYPE: YOUTUBE
            mediaContainer.classList.remove('hidden');
            youtubeEmbed.classList.remove('hidden');
            youtubeEmbed.innerHTML = `<iframe id="ytplayer" type="text/html" width="100%" height="100%" src="${data.videoSrc}" frameborder="0" allowfullscreen></iframe>`;
        } else if (data.image) {
            // VIEW TYPE: IMAGE (For Structure Map)
            mediaContainer.classList.remove('hidden');
            pImg.src = data.image;
            pImg.classList.remove('hidden');
        } else if (data.video) {
            // VIEW TYPE: LOCAL VIDEO
            mediaContainer.classList.remove('hidden');
            pVid.src = data.video;
            pVid.classList.remove('hidden');
        }

        // --- Center Modal Logic ---
        contentPanel.classList.add('panel-visible');
        overlay.classList.remove('hidden');
        setTimeout(() => overlay.classList.remove('opacity-0'), 10);
    }

    function closePanel() {
        contentPanel.classList.remove('panel-visible');
        overlay.classList.add('opacity-0');
        setTimeout(() => overlay.classList.add('hidden'), 300);

        setTimeout(() => {
            youtubeEmbed.innerHTML = '';
            pVid.pause();
        }, 300);

        if (state.activeLeaf) {
            state.activeLeaf.classList.remove('active-node');
            state.activeLeaf = null;
        }
    }

    // --- Utils ---
    function createLine(el1, el2, cls) {
        const x1 = parseFloat(el1.style.left);
        const y1 = parseFloat(el1.style.top);
        const x2 = parseFloat(el2.style.left);
        const y2 = parseFloat(el2.style.top);
        const dist = Math.hypot(x2 - x1, y2 - y1);
        const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

        const line = document.createElement('div');
        line.className = `connecting-line ${cls}`;
        line.style.width = `0px`;
        line.style.left = `${x1}px`;
        line.style.top = `${y1}px`;
        line.style.transform = `rotate(${angle}deg)`;
        galaxy.appendChild(line);
        requestAnimationFrame(() => {
            line.style.width = `${dist}px`;
            line.style.opacity = 1;
        });
    }

    init();
</script>
</body>
</html>
